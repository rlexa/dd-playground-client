<div ddFlexbox="vys">
  <mat-card ddFlexitem="at">
    <mat-card-title>Polynomial</mat-card-title>
    <mat-card-content>
      <div ddFlexbox="vys">

        <div ddFlexbox="hyscsw" class="childhv">

          <div ddFlexbox="vys" class="container hovered-elevated">
            <table *ngIf="factorsCurrent$ | async as factorsCurrent">
              <tr>
                <td></td>
                <td *ngFor="let _ of factorsCurrent; let iFactor = index; trackBy: trackByIndex">
                  <mat-form-field class="width-short-input font-table-input mat-input-save-subspace childh">
                    <input matInput type="number" [min]="-factorRange" [max]="factorRange" [disabled]="busy$ | async" required [value]="factorsCurrent[iFactor]"
                      (change)="updateFactor(factorsCurrent, iFactor, +$event.target.value, $event.target)">
                  </mat-form-field>
                </td>
              </tr>
              <tr *ngFor="let factors of [factorsCurrent, factorsTrained$ | async]; let iFactors = index;" [ngStyle]="{'color': colors[iFactors % colors.length], 'vertical-align': 'bottom'}">
                <td class="text-nowrap">f(x) = </td>
                <ng-container *ngFor="let factor of factors; let ii = index;">
                  <td>
                    {{ (factor >= 0 ? ' +' : ' ') + (factor | d3number:'.2r') }}
                    <ng-container *ngIf="ii+1 < factors.length">
                      {{ 'x' }}
                      <sup *ngIf="ii+2 < factors.length" class="font-small">{{ factors.length - 1 - ii }}</sup>
                    </ng-container>
                  </td>
                </ng-container>
              </tr>
            </table>

            <div ddFlexbox="hys">
              <div class="childh">
                <button mat-raised-button (click)="generatePoints()" [disabled]="busy$ | async">NEW POINTS</button>
              </div>
              <div class="childh">
                <button mat-raised-button (click)="resetTrained()" [disabled]="busy$ | async">RESET TRAINED</button>
              </div>
            </div>
          </div>

          <app-simple-view class="childhv hovered-elevated" subheader="TFJS Memory" [isDense]="true" [isWidthConstrained]="false" [data]="tfjsState$ | async"></app-simple-view>

          <div ddFlexbox="vys" class="childhv container hovered-elevated">
            <div ddFlexbox="hye" class="childhv">
              <mat-form-field class="childh width-short-input font-table-input">
                <input matInput type="number" placeholder="Rate" [disabled]="busy$ | async" step=".1" min="0.01" [value]="learningRate$ | async"
                  (change)="setLearningRate(+$event.target.value)">
              </mat-form-field>
              <mat-form-field class="childh width-shorter-input font-table-input">
                <mat-select placeholder="Optimizer" [value]="(optimizer$ | async)" (selectionChange)="setOptimizer($event.value)">
                  <mat-option *ngFor="let ii of optimizers$ | async" [value]="ii"> {{ ii }} </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div ddFlexbox="hyscsw" class="childhv">
              <button *ngFor="let ii of [1, 5, 10, 100, 1000]; let iindex= index;" mat-raised-button class="auto-min-width" (click)="trainMlPolynomial(ii)"
                [disabled]="busy$ | async">
                {{ (iindex === 0 ? 'TRAIN ' : '') + 'x' + ii }}
              </button>
            </div>
          </div>
        </div>

        <app-diagram-polynom [style.minWidth]="'60rem'" ddFlexitem="at" [points]="pointsCurrent$ | async" [polynomials]="[factorsCurrent$ | async, factorsTrained$ | async]"
          [polynomialColors]="colors"></app-diagram-polynom>
      </div>
    </mat-card-content>
  </mat-card>
</div>